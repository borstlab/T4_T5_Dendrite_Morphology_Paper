[![DOI](https://zenodo.org/badge/123456789.sv)](https://doi.org/10.5281/zenodo.18269709)

# Population Morphology Implies a Common Developmental Blueprint for *Drosophila* Motion Detectors

Nikolas Drummond, Arthur Zhao, Alexander Borst

[BiorXiv](https://www.biorxiv.org/content/10.1101/2025.11.15.688637v1)

This is the repository for the paper: "Population Morphology Implies a Common Developmental Blueprint for *Drosophila* Motion Detectors". it includes datasets of extracted dendrite morphology metrics, and code for reproducing analysis and figures.

## Abstract

> Detailed characterization of neuronal morphology provides vital clues for understanding the wiring logic and development of neural circuits. As neuron arbours can both span large distances, and be densely interwoven, one major challenge is acquiring and quantifying fine structures for independent arbours over large spatial extents. Recent whole-brain Electron Microscopy (EM) connectomes of *Drosophila melanogaster* provide an ideal opportunity to study fly neuronal morphology at scale. Utilising this rich resource, we developed novel computational methods and morphological metrics to perform the most comprehensive morphological analysis on the dendrites of the T4 and T5 neurons in the fly brain.

> T4 and T5 neurons are the first direction-selective neurons in the visual pathway. They are the most numerous cell types in the fly brain (~6000 within each optic lobe) and as a population, their compact dendritic arbours span the entire visual field. They are classified into four subtypes (a,b,c, and d). Each subtype encodes one of four orthogonal motion directions (up, down, forwards, backwards). The dendrites of these neurons form in two distinct neuropils, the Medulla (T4) and the Lobula (T5), and respond to ON (light increments, T4) and OFF (light decrements, T5) motions. T4 and T5 neurons' dendrites are oriented against their preferred direction of motion. However, the differences beyond their characteristic orientation, both between T4 and T5, as well as within subtypes, has remained poorly understood.

> Our analysis reveals a high degree of structural similarity between T4 and T5, and within their subtypes. Particularly, the geometry of branching, section orientation, and tree-graph structure of these dendrites shows only minor variability, with no consistent separation between T4 and T5, or their subtypes.
 
> These results indicate that, despite forming in different neuropils, and serving distinct motion directions, T4 and T5 dendrites follow closely aligned morphological patterns. This suggests a shared developmental mechanism.

## Repository Structure

```
.
├── Data
├── Notebooks
└── src
```

`Data` contains pickled `pandas.DataFrame` files which contain all the data needed to run analysis and reconstruct all figures within the paper. Additionally a `.csv` file is included which contains the neuron ID of every neuron used within this paper in [flywire](flywire.ai).

`Notebooks` contains a set of jupyter notebooks for running statistical analysis using the provided data, as well as reproduce all figures within the manuscript.

`src` contains `.py` files with functions needed to run the various analysis and plotting notebooks.

## Included Data

### `Neuron_ids.csv`

Table of neuron ids for finding each neuron in flywire, as well as there type/subtype designation and if dendrites where successfully annotated, required for inclusion in analysis.

|Column       | Description| dtype|
|-------------|------------|------|
|Flywire_id   |Neuron flywire id|int|
|Subtype      |Subtype, eg T4a, T5b|str|
|Dendrite_used|True if the neuron was included in analysis|bool|

### `Point_data.pkl`

This file is a pickled pandas.DataFrame with all metrics used, and data values, which can be summarised as a single observation per neuron dendrite.

|Column|Description|Units|dtype|
|-|-|-|-|
|ID|Neuron flywire id||int|
|Type|Type [T4, T5]||str|
|Subtype|Subtype, eg T4a, T5b||str|
|Root_x|x coordinate of dendrite root||float|
|Root_y|y coordinate of dendrite root||float|
|Root_z|z coordinate of dendrite root||float|
|Segment_Count|Number of sections within the reduced dendrite||int|
|Total_Cable|Total dendrite cable length|$nm$|int|
|Vertices_numbers|Number of branch and leaf nodes +1 (the root)||int|
|External_edge_count|Number of terminating edges||int|
|Internal_edge_count|Number of edges enclosed between root and branch points||int|
|Leaf_number|Number of leaf nodes||int|
|Branch_number|Number of (internal) branching nodes||int|
|PC1|Variance explained by first principal component||float|
|PC2|Variance explained by second principal component||float|
|PC3|Variance explained by third principal component||float|
|PC1_angle|Angle of first eigen-vector relative to global Dorsal-Ventral axes|radians|float|
|Hull_volume|Volume of Convex hull fitted to dendrite points|$\mu m^3$|float|
|Scaled_hull_volume|Hull volume scaled by neuropil layer volume||float|
|Mean_segment_angle|Mean angle of sections relative to Anterior-Posterior axis|radians|float|
|Segment_angle_var|Angular variance of section angles||float|

### `Vertex_data.pkl`

Pickled `pandas.DataFrame` containing all values for single nodes within dendrite tree-graph.

|Column|Description|Units|dtype|
|-|-|-|-|
|ID|Neuron flywire id||int|
|Type|Type [T4, T5]||str|
|Subtype|Subtype, eg T4a, T5b||str|
|Out_degree|out-degree of node||int|
|Weighted_asymmetry|weighted partition asymmetry of node||float|
|Euclidean_distance|Normalised Euclidean distance from the dendrite root, normalized by maximum distance in dendrite||float|
|Layer_Depth|Normalized node depth in neuropil layer (Medulla layer 10 for T4, Lobula layer 1 for T5)||float|

### `Edge_data.pkl`

Pickled `pandas.DataFrame` containing all metrics for single edges within dendrites for all morphologies.

|Column|Description|Units|dtype|
|-|-|-|-|
|ID|Neuron flywire id||int|
|Type|Type [T4, T5]||str|
|Subtype|Subtype, eg T4a, T5b||str|
|isExternal|True if this is an external edge (terminating edge)||bool|
|Edge_angle|Angle of section/edge relative to the global AP axis|radians|float|
|Radial_angle_signed|Signed angle of edge relative to vector from the dendrite root|radians|float|
|Depth|Depth of the edge/section within the tree graph (number of steps from the dendrite root)||int|
|Length|Length of the dendrite section/edge|$\mu m$|float|
|Length_varScaled|Length of section/edge in variance scaled dendrite||float|

### `Bifurcation_data.pkl`

|Column|Description|Units|dtype|
|-|-|-|-|
|ID|Neuron flywire id||int|
|Type|Type [T4, T5]||str|
|Subtype|Subtype, eg T4a, T5b||str|
|Parent_angle_1|Angle between parent section and first child section $(\gamma)$|radians|float|
|Parent_angle_2|Angle between parent section and second child section $(\omega)$|radians|float|
|Child_angle|Angle between two child sections $(\theta)$|radians|float|
|Angle_sum|Sum of $\gamma$, $\omega$, and $\theta$.|radians|float|
|Dihedral_Beta|Bifurcation Dihedral angle $\beta$|radians|float|


## Notebooks

### `ANOVA_analysis.ipynb`

This notebook illustrates ANOVA/ANCOVA as used in the manuscript. This covers fitting OLS regression models and ANOVA/ANCOVA, as well as getting effect sizes wth bootstrapped confidence intervals.

### `Figure_#.ipynb`

Notebooks illustrating the generation of all graphs plotted within the manuscript, split by figure.

## src

### `figure_Tools.py`

Functions used for plotting various graphs used within the manuscripts,m used by `Figure_#` notebooks.

### `paper_ANOVA.py`

Statistical functions and classes for `ANOVA_analysis.ipynb`.

### `Nearest_neighbours.py`

Functions needed for plotting nearest neighbours and subtype agnostic nearest neighbour matching using max cardinality, as in figure 4 of the manuscript.

### `Random_bifurcations.py`

Functions for generating random bifurcations constrained along an axis, as well as sum and Dihedral angle $\beta$ as in figure 5 k and l.

### `dist_fit.py`

Distribution fitting module making use of the [FITTER](https://fitter.readthedocs.io/en/latest/) toolbox, which is built around scipy. Used for figure 7.

## Usage

You can create a conda environment to run the nodebooks here using the provided `conda-environment.yml` file:

``` bash
conda env create -f conda-environment.yml
conda activate T45_paper
```